<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>DUO Academia — PAR-Q</title>
  <meta name="description" content="Questionário de Prontidão para Atividade Física (PAR-Q) com CPF obrigatório e termo com rúbrica sempre obrigatório." />
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --fg:#e5e7eb; --line:#1f2937; --brand:#3b82f6; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444;
      --zoom:1.12; /* aumenta tudo sem quebrar layout */
    }
    *{box-sizing:border-box}
    html,body{height:100%; overflow-x:hidden;}
    html{font-size:clamp(17px, 3.2vw, 20px);}      /* tipografia maior (efeito de “app”) */
    body{
      margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:var(--bg); color:var(--fg);
      transform:scale(var(--zoom)); transform-origin: top center;  /* “zoom concentrado” */
    }
    .wrap{max-width:780px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 0 24px;border-bottom:1px solid var(--line)}
    h1{font-size:1.15rem;margin:0;font-weight:800}
    .badge{font-size:.72rem;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:20px} /* foca no formulário */
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h2{font-size:1rem;margin:0 0 12px}
    .row{display:grid;grid-template-columns:1fr 1fr; gap:12px}
    .row-1{grid-template-columns:1fr}
    @media (max-width: 760px){.row{grid-template-columns:1fr}}
    label{display:block;font-size:.8rem;color:var(--muted);margin:10px 0 6px}
    input,select,textarea{width:100%;background:#0b1220;border:1px solid #1c2536;color:var(--fg);border-radius:12px;padding:14px;outline:none;font-size:.95rem}
    input:focus,textarea:focus,select:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    #nome{text-transform:uppercase;}
    .help{font-size:.75rem;color:var(--muted);margin-top:4px}
    .buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:18px}
    .btn{appearance:none;border:1px solid #2a3448;background:#162136;color:#dbeafe;padding:10px 14px;border-radius:10px;cursor:pointer;font-size:.95rem}
    .btn.primary{background:var(--brand); border-color:var(--brand); color:white}
    .btn.success{background:var(--ok); border-color:var(--ok); color:#001a07}
    .btn.danger{background:var(--danger); border-color:var(--danger); color:white}
    .terms{border:1px dashed #334155;border-radius:12px;padding:12px; background:#0b1220; max-height:240px; overflow:auto;}
    .checkbox{display:flex;gap:10px;align-items:center;margin:12px 0}
    .checkbox input.ck{appearance:none; -webkit-appearance:none; width:24px; height:24px; border:2px solid #334155; border-radius:6px; background:#fff; display:inline-grid; place-content:center; cursor:pointer; outline:none}
    .checkbox input.ck::before{content:""; width:16px; height:16px; transform:scale(0); transition:120ms transform ease-in-out; background:var(--brand); border-radius:4px}
    .checkbox input.ck:checked::before{transform:scale(1)}
    .checkbox span{font-size:.95rem; color:#e5e7eb; font-weight:700}
    .checkbox input.ck:focus{box-shadow:0 0 0 3px rgba(59,130,246,.35)}
    .sig-wrap{background:#0b1220;border:1px solid #1c2536;border-radius:12px;padding:12px}
    canvas{width:100%;height:180px;background:#ffffff;border-radius:8px;border:0;touch-action:none}
    .muted{color:var(--muted)}
    .hr{height:1px;background:#1f2937;border:0;margin:12px 0}
    footer{margin-top:20px;font-size:.75rem;color:var(--muted);text-align:center}

    /* Printable area (prévia compacta mas legível) */
    .sheet{background:white;color:#111; width:794px; min-height:1123px; padding:28mm 20mm; border:1px solid #ddd; border-radius:6px; box-shadow:0 4px 30px rgba(0,0,0,.15);
      word-spacing: .06em; letter-spacing: .01em; text-rendering: optimizeLegibility; -webkit-font-smoothing: antialiased; font-kerning: normal; hyphens: none; word-break: normal; overflow-wrap: anywhere;
      transform:scale(.92); transform-origin: top left;
    }
    .sheet h3, .sheet th, .sheet strong, .sheet .title-tight { word-spacing: .08em; letter-spacing: .02em; }
    .sheet h3{margin:0 0 8px}
    .sheet small{color:#555}
    .sheet .section{margin-top:14px}
    .sheet table{width:100%; border-collapse:collapse; font-size:13px}
    .sheet th,.sheet td{border:1px solid #ccc; padding:10px 12px; text-align:left; vertical-align:middle}
    #pv_questions th:nth-child(2), #pv_questions th:nth-child(3),
    #pv_questions td:nth-child(2), #pv_questions td:nth-child(3){ width:10.5%; text-align:center; }
    #pv_questions td.sn{font-size:18px; font-weight:800; letter-spacing:.05em}
    .sheet .sign-img{width:100%; height:120px; max-height:120px; border:0; border-radius:0; object-fit:contain; display:block; margin:0 auto}
    .sheet .sign-area{display:flex; gap:16px; align-items:flex-end; margin-top:12px}
    .sheet .sign-box{flex:1}
    .sheet .line{height:1px;background:#ccc;margin:6px 0}
    .sheet .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .sheet .brand{display:flex; align-items:flex-start; gap:10px;}
    .sheet .brand img.logo{height:34px; width:auto; display:block;}

    /* Radios segmentados */
    .opts{display:inline-flex; gap:10px; align-items:center; flex-wrap:nowrap}
    .seg{display:inline-flex; align-items:center; border-radius:999px; overflow:hidden}
    .seg input{position:absolute; opacity:0; pointer-events:none}
    .seg span{display:inline-block; padding:10px 18px; border:1px solid #334155; border-radius:999px; background:#0b1220; color:#e5e7eb; font-weight:800; line-height:1; user-select:none; cursor:pointer;}
    .seg input:focus + span{box-shadow:0 0 0 3px rgba(59,130,246,.35)}
    .seg input:checked + span{background:var(--brand); color:white; border-color:var(--brand)}
    .q{display:none; grid-template-columns: 1fr auto; align-items:center; gap:14px; padding:14px 0; border-bottom:1px dashed #2a3346}
    .q.active{display:grid;}           /* mostra só a pergunta ativa */
    .q strong{font-weight:800}
    @media (max-width:520px){
      .q{grid-template-columns: 1fr}
      .opts{gap:8px}
    }
    #row_data{display:none}

    /* Pré-visualização embaixo, discreta (mantida para PDF) */
    .preview{margin-top:18px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>DUO Academia · PAR-Q (Questionário de Prontidão Para Atividade Física)</h1>
        <div class="badge">Responda as perguntas. Ao final, aceite o termo e assine. Depois gere o PDF.</div>
      </div>
      <div class="badge" id="progressBadg">1/7</div>
    </header>

    <div class="grid">
      <div class="card" id="formCard">
        <h2>1) Identificação</h2>
        <div class="row">
          <div>
            <label for="nome">Nome completo</label>
            <input id="nome" placeholder="Ex.: JOÃO DA SILVA" />
          </div>
          <div>
            <label for="cpf">CPF</label>
            <input id="cpf" inputmode="numeric" maxlength="14" placeholder="000.000.000-00" />
            <div class="help">Obrigatório</div>
          </div>
        </div>

        <!-- data oculta (preenchida via JS) -->
        <div id="row_data" class="row">
          <div>
            <label for="data_assinatura">Data</label>
            <input id="data_assinatura" type="date"/>
          </div>
        </div>

        <h2 style="margin-top:18px">2) PAR-Q (responda S/N)</h2>
        <div class="terms" style="margin-bottom:8px">
          <div style="font-size:.9rem; line-height:1.5">
            Em conformidade com a <strong>Lei n.º 15.619/2015</strong>, este questionário identifica a necessidade de avaliação médica antes do início da atividade física.
          </div>
        </div>

        <!-- Perguntas (uma por vez) -->
        <div class="q active"><strong>1. Tem algum problema cardíaco de qualquer tipo?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q1" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q1" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>2. Sente dores no peito quando pratica exercícios?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q2" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q2" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>3. Recentemente sentiu dores no peito durante algum exercício físico?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q3" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q3" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>4. Apresenta desequilíbrio ou tontura levando ao desmaio?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q4" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q4" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>5. Tem algum problema osteomioarticular que possa piorar com o exercício?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q5" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q5" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>6. Usa algum medicamento para pressão arterial ou coração?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q6" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q6" value="N"><span>Não</span></label>
          </div>
        </div>
        <div class="q"><strong>7. Sabe de alguma razão pela qual não deve praticar exercícios?</strong>
          <div class="opts">
            <label class="seg"><input type="radio" name="q7" value="S"><span>Sim</span></label>
            <label class="seg"><input type="radio" name="q7" value="N"><span>Não</span></label>
          </div>
        </div>

        <!-- TERMO (sempre obrigatório, aparece apenas após terminar as 7 perguntas) -->
        <div id="anexo2_card" class="card" style="margin-top:14px; display:none; background:#0b1220">
          <h2>Termo de responsabilidade (obrigatório)</h2>
          <div style="font-size:.9rem; line-height:1.55; margin-bottom:8px">
            Declaro estar ciente de que é recomendável a consulta médica antes de aumentar meu nível de atividade física. Assumo plena responsabilidade por minha prática e concordo com os termos.
          </div>
          <label class="checkbox">
            <input id="aceite" class="ck" type="checkbox">
            <span>Li e concordo com o termo acima.</span>
          </label>
          <div class="sig-wrap">
            <label>Rúbrica/Assinatura</label>
            <canvas id="signaturePad" width="900" height="360" aria-label="Área para assinatura com o dedo ou mouse"></canvas>
            <div class="buttons">
              <button class="btn" id="btnLimpar">Limpar</button>
            </div>
          </div>

          <div class="buttons" style="margin-top:6px">
            <button class="btn success" id="btnPDF">Gerar PDF</button>
            <button class="btn danger" id="btnReset">Resetar formulário</button>
          </div>
        </div>
      </div>

      <!-- Pré-visualização para PDF -->
      <div class="card preview">
        <h2>Pré-visualização do documento (PDF)</h2>
        <div class="help">Atualiza automaticamente conforme você preenche.</div>
        <div id="printArea" class="sheet" aria-label="Área imprimível">
          <div style="display:flex;justify-content:space-between;align-items:flex-start">
            <div class="brand">
              <img id="sheet_logo" class="logo" alt="Logo DUO" crossorigin="anonymous" />
              <div>
                <h3>DUO ACADEMIA</h3>
                <small>Av. Simoa Gomes, 726 – Heliópolis · R. Dom José, 187 – Santo Antônio<br>
                (87) 9.9666-0021 | (87) 9.9934-1230 · coordenacaoduoacademia@gmail.com<br></small>
              </div>
            </div>
            <div style="text-align:right">
              <div style="font-size:12px;color:#444">Código: <span id="doc_id"></span></div>
              <div style="font-size:12px;color:#444">Data: <span id="doc_data"></span></div>
            </div>
          </div>
          <div class="line"></div>

          <div class="section">
            <table>
              <tr><th colspan="2">ANEXO I — QUESTIONÁRIO DE PRONTIDÃO PARA ATIVIDADE FÍSICA (PAR-Q)</th></tr>
              <tr><td style="width:26%">Nome completo</td><td id="pv_nome"></td></tr>
              <tr><td>CPF</td><td id="pv_cpf"></td></tr>
              <tr><td colspan="2" style="font-size:12.5px">
                Em conformidade com a Lei n.º 15.619/2015.
              </td></tr>
            </table>
          </div>

          <div class="section">
            <table id="pv_questions">
              <tr><th style="width:79%">Pergunta</th><th>S</th><th>N</th></tr>
              <tr><td>1. Apresenta problema cardíaco de qualquer tipo</td><td id="p1s" class="sn"></td><td id="p1n" class="sn"></td></tr>
              <tr><td>2. Sente dores no peito quando pratica exercícios</td><td id="p2s" class="sn"></td><td id="p2n" class="sn"></td></tr>
              <tr><td>3. Sentiu dores no peito recentes durante exercício</td><td id="p3s" class="sn"></td><td id="p3n" class="sn"></td></tr>
              <tr><td>4. Apresenta desequilíbrio/tontura levando ao desmaio</td><td id="p4s" class="sn"></td><td id="p4n" class="sn"></td></tr>
              <tr><td>5. Problema osteomioarticular que pode piorar com exercício</td><td id="p5s" class="sn"></td><td id="p5n" class="sn"></td></tr>
              <tr><td>6. Usa remédio para pressão/coração</td><td id="p6s" class="sn"></td><td id="p6n" class="sn"></td></tr>
              <tr><td>7. Conhece alguma razão para não praticar exercícios</td><td id="p7s" class="sn"></td><td id="p7n" class="sn"></td></tr>
            </table>
          </div>

          <!-- Anexo II sempre presente no PDF -->
          <div id="anexo2_sheet" class="section">
            <table>
              <tr><th colspan="1">ANEXO II — TERMO DE RESPONSABILIDADE</th></tr>
              <tr><td style="font-size:13px">
                Declaro estar ciente de que é recomendável a consulta médica antes de aumentar meu nível de atividade física. Assumo plena responsabilidade por minha prática e concordo com os termos.
              </td></tr>
              <tr>
                <td>
                  <div class="sign-area">
                    <div class="sign-box">
                      <img id="pv_assinatura" class="sign-img" alt="Assinatura" />
                      <div class="line"></div>
                      <div style="font-size:12px;color:#555">Assinatura ou Rúbrica do Contratante</div>
                    </div>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <footer>
          Dica: você também pode usar <strong>Imprimir &gt; Salvar como PDF</strong> se preferir.
        </footer>
      </div>
    </div>
  </div>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script>
    const $ = (s) => document.querySelector(s);
    const onlyDigits = (v) => (v||'').replace(/\D+/g,'');
    const maskCPF = (v) => {
      v = onlyDigits(v).slice(0,11);
      return v.replace(/(\d{3})(\d)/, '$1.$2')
              .replace(/(\d{3})(\d)/, '$1.$2')
              .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    };
    function isValidCPF(cpf){
      cpf = onlyDigits(cpf);
      if (cpf.length !== 11) return false;
      if (/^(\d)\1{10}$/.test(cpf)) return false;
      let sum = 0, rest;
      for (let i=1;i<=9;i++) sum += parseInt(cpf.substring(i-1,i)) * (11 - i);
      rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; if (rest !== parseInt(cpf.substring(9,10))) return false;
      sum = 0; for (let i=1;i<=10;i++) sum += parseInt(cpf.substring(i-1,i)) * (12 - i);
      rest = (sum * 10) % 11; if (rest === 10 || rest === 11) rest = 0; return rest === parseInt(cpf.substring(10,11));
    }
    function normalizeName(s){
      const noAccents = s.normalize('NFD').replace(/\p{Diacritic}/gu,'');
      return noAccents.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
    }

    // Logo (param ?logo=)
    const DEFAULT_LOGO = 'logo.png';
    const urlParamLogo = new URLSearchParams(location.search).get('logo');
    const logoSrc = urlParamLogo || DEFAULT_LOGO;
    (function setLogo(){ const img=$('#sheet_logo'); if(img){img.src=logoSrc; img.setAttribute('crossorigin','anonymous');} })();

    // Data de hoje
    function setTodayBR(){
      try{
        const parts = new Intl.DateTimeFormat('pt-BR',{timeZone:'America/Fortaleza', day:'2-digit', month:'2-digit', year:'numeric'}).formatToParts(new Date());
        const dd = parts.find(p=>p.type==='day').value;
        const mm = parts.find(p=>p.type==='month').value;
        const yyyy = parts.find(p=>p.type==='year').value;
        const iso = `${yyyy}-${mm}-${dd}`;
        $('#data_assinatura').value = iso;
        $('#doc_data').textContent = `${dd}/${mm}/${yyyy}`;
      }catch(e){
        const t=new Date(), yyyy=t.getFullYear(), mm=String(t.getMonth()+1).padStart(2,'0'), dd=String(t.getDate()).padStart(2,'0');
        const iso=`${yyyy}-${mm}-${dd}`; $('#data_assinatura').value=iso; $('#doc_data').textContent=`${dd}/${mm}/${yyyy}`;
      }
    }

    // Assinatura
    let signaturePad, canvas;
    function ensureSignaturePad(){
      if (signaturePad) return;
      canvas = document.getElementById('signaturePad');
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      canvas.width = rect.width * ratio;
      canvas.height = rect.height * ratio;
      const ctx = canvas.getContext('2d'); ctx.scale(ratio, ratio);
      signaturePad = new SignaturePad(canvas, { backgroundColor:'#fff', penColor:'#111827', minWidth:0.7, maxWidth:2.0, throttle:0 });
      canvas.addEventListener('mouseup', renderPreview);
      canvas.addEventListener('touchend', renderPreview);
      $('#btnLimpar').addEventListener('click', (e)=>{ e.preventDefault(); signaturePad.clear(); renderPreview(); });
      window.addEventListener('resize', ()=>{
        const data = signaturePad.toData();
        const rect = canvas.getBoundingClientRect();
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = rect.width * ratio; canvas.height = rect.height * ratio;
        const ctx = canvas.getContext('2d'); ctx.scale(ratio, ratio);
        signaturePad.clear(); signaturePad.fromData(data);
      });
    }

    // Estado de perguntas em passos
    const questions = Array.from(document.querySelectorAll('.q'));
    let step = 0;
    function updateProgress(){
      $('#progressBadg').textContent = `${Math.min(step+1,7)}/7`;
    }
    function showStep(i){
      questions.forEach((q,idx)=> q.classList.toggle('active', idx===i));
      updateProgress();
      if (questions[i]) {
        questions[i].scrollIntoView({behavior:'smooth', block:'center'});
      }
    }

    function answers(){
      const a = {};
      for(let i=1;i<=7;i++){
        const v = document.querySelector(`input[name="q${i}"]:checked`);
        a[`q${i}`] = v ? v.value : '';
      }
      return a;
    }

    function renderPreview(){
      const nomeRaw = $('#nome').value || '';
      const nomeUpper = nomeRaw.toLocaleUpperCase('pt-BR');
      if (nomeRaw !== nomeUpper) $('#nome').value = nomeUpper;

      const cpf = $('#cpf').value.trim();
      const data = $('#data_assinatura').value;
      $('#pv_nome').textContent = nomeUpper;
      $('#pv_cpf').textContent = cpf;
      if (data) {
        try{ $('#doc_data').textContent = new Intl.DateTimeFormat('pt-BR').format(new Date(data)); }catch(e){}
      }

      const a = answers();
      for(let i=1;i<=7;i++){
        $('#p'+i+'s').textContent = a['q'+i]==='S' ? 'X' : '';
        $('#p'+i+'n').textContent = a['q'+i]==='N' ? 'X' : '';
      }

      // Anexo II sempre no PDF; na tela só aparece depois de concluir as perguntas
      const img = $('#pv_assinatura');
      if (signaturePad && !signaturePad.isEmpty()){
        img.src = signaturePad.toDataURL('image/png');
      } else {
        img.src = '';
      }
    }

    async function generatePDF(){
      const nome = ($('#nome').value || '').trim();
      const cpf = $('#cpf').value.trim();
      if (!nome) { alert('Informe o seu nome completo.'); return; }
      if (!isValidCPF(cpf)) { alert('CPF inválido.'); return; }

      // Todas as perguntas respondidas?
      const a = answers();
      const unanswered = Object.values(a).some(v => v === '');
      if (unanswered) { alert('Responda todas as 7 perguntas antes de gerar o PDF.'); return; }

      // Termo e assinatura SEMPRE obrigatórios
      if (!$('#aceite').checked){ alert('Você precisa aceitar o termo.'); return; }
      if (!signaturePad || signaturePad.isEmpty()){ alert('Assine (rúbrica) no quadro para continuar.'); return; }

      // código interno e prévia
      $('#doc_id').textContent = new Date().toISOString().replace(/[-:TZ.]/g, '').slice(0, 14);
      renderPreview();

      // captura área imprimível
      const area = document.getElementById('printArea');
      const canvasImg = await html2canvas(area, { scale: 2, useCORS: true });
      const imgData = canvasImg.toDataURL('image/png');
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p','mm','a4');
      const pageWidth = pdf.internal.pageSize.getWidth();
      const w = pageWidth - 20, h = (canvasImg.height * w) / canvasImg.width;
      pdf.addImage(imgData, 'PNG', 10, 10, w, h, undefined, 'FAST');

      const d = new Date($('#data_assinatura').value || Date.now());
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yyyy = String(d.getFullYear());
      const nomeFile = normalizeName(nome);
      const filename = `PARQ_${nomeFile}_${dd}${mm}${yyyy}.pdf`;

      pdf.save(filename);
    }

    // Eventos
    ['nome','cpf','data_assinatura'].forEach(id => {
      const el=$('#'+id);
      if(!el) return;
      el.addEventListener('input', renderPreview);
      el.addEventListener('change', renderPreview);
    });
    $('#cpf').addEventListener('input', (e)=> e.target.value = maskCPF(e.target.value));
    $('#nome').addEventListener('input', (e)=>{ e.target.value = (e.target.value||'').toLocaleUpperCase('pt-BR'); });

    // Avanço automático por pergunta
    questions.forEach((q, idx) => {
      q.querySelectorAll('input[type="radio"]').forEach(radio => {
        radio.addEventListener('change', () => {
          renderPreview();
          step = idx + 1;
          if (step < questions.length){
            showStep(step);
          } else {
            // terminou as 7 -> exibe termo obrigatório
            const termo = $('#anexo2_card');
            termo.style.display = 'block';
            ensureSignaturePad();
            termo.scrollIntoView({behavior:'smooth', block:'start'});
          }
        });
      });
    });

    // Botões do termo
    document.addEventListener('click', (e)=>{
      if(e.target && e.target.id === 'btnPDF'){ e.preventDefault(); generatePDF(); }
      if(e.target && e.target.id === 'btnReset'){ e.preventDefault(); if(confirm('Limpar todos os campos?')) location.reload(); }
    });

    setTodayBR();
    renderPreview();
    showStep(0);
  </script>
</body>
</html>
